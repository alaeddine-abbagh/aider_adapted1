  # Process any image content to match company API format
        processed_messages = json.loads(json.dumps(messages))  # Deep copy
        for message in processed_messages:
            if isinstance(message.get("content"), list):
                for part in message["content"]:
                    if part.get("type") == "image_url":
                        # Aider provides the image URL as a local file path
                        image_path = part["image_url"]["url"]
                        if os.path.exists(image_path):
                            base64_image = encode_image(image_path)
                            image_type = image_path.split('.')[-1]
                            part["image_url"]["url"] = f"data:image/{image_type};base64,{base64_image}"
